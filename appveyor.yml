version: 0.1.{build}
image:
# - Ubuntu1604
- Visual Studio 2017
install:
- cmd: choco install bazel
- sh: >-
    sudo apt-get install pkg-config zip g++ zlib1g-dev unzip python

    sudo apt-get install openjdk-8-jdk

    sudo add-apt-repository ppa:webupd8team/java

    sudo apt-get update && sudo apt-get install oracle-java8-installer

    echo "deb [arch=amd64] http://storage.googleapis.com/bazel-apt stable jdk1.8" | sudo tee /etc/apt/sources.list.d/bazel.list

    curl https://bazel.build/bazel-release.pub.gpg | sudo apt-key add -

    sudo apt-get update && sudo apt-get install bazel
- ps: .\download_and_build_third_party_libs_windows.ps1
- sh: ./download_and_build_third_party_libs.sh
- cmd: cd LuaJIT\src
- ps: .\msvcbuild.bat
- cmd: cd ..\..
build_script:
- cd ..
- bazel build //automaton/...
test_script:
- bazel test //automaton/tests/...
